<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mips Simulator</title>
    <link rel="stylesheet" href="css/w3.css">
    <style>
        html,
        body {
            margin: 0 auto;
        }

        #close {
            cursor: pointer;
            padding: 2px;
        }

        #close:hover {
            background-color: #444 !important;
        }

        #close i {
            border: solid white;
            border-width: 0 3px 3px 0;
            display: inline-block;
            padding: 3px;

            transform: rotate(-135deg);
            -webkit-transform: rotate(-135deg);
        }

        #close.hid i {
            transform: rotate(45deg);
            -webkit-transform: rotate(45deg);
        }

        #file-input {
            position: absolute;
            opacity: 0;
            z-index: -1;
        }

        .none {
            display: none;
        }

    </style>
</head>

<body>
    <section>
        <div id="hide" class="w3-cell-row w3-padding w3-gray">
            <div class="w3-container w3-cell w3-cell-middle w3-center">
                <h5 class="w3-center">Entrada do codigo</h5>
                <textarea id="text-input" cols="32" rows="5">
00001100000000000000000000000010
00001000000000000000000000000010
00100000000010100000000011111111
00100000000010110000000011111110
00000011111000000000000000001000
00100000000010100000000010101011
00100000000011010000000011111000
00010101010010011111111111111011
00010001001010011111111111111011
00000000000010100100100010000000
00000001100010100111000000101010
10101100001010100000000000000100
10001100001010000000000000000100
00000001010010110100100000100000
00000001010010110100000000100010
00000001010010110100100000100100
00000001100011010111000000100101
                </textarea>
                <br>

                <div class="w3-bar w3-center" style="margin-top: 1em;">
                    <label class="w3-button w3-black" for="file-input">Abrir arquivo...</label>
                    <input type="file" name="btn-input" id="file-input" class="w3-button w3-black"
                        style="font-size: 0.8em;">

                    <button id="btn-load" class="w3-button w3-red">Carregar para memoria</button>
                </div>
            </div>

            <div class="w3-container w3-cell w3-cell-right w3-center">
                <h5 class="w3-center">Saida</h5>
                <textarea id="text-output" cols="40" rows="5" readonly>
                </textarea>
                <br>

                <div class="w3-bar w3-center" style="margin-top: 1em;">
                    <a id="btn-download" class="w3-button w3-red">Salvar arquivo</a>
                </div>
            </div>
        </div>

        <div class="w3-cell-row w3-padding-8 w3-black">
            <div id="close" class="w3-cell w3-cell-middle w3-center" onclick="wrap();">
                Esconder
                <i></i>
            </div>
        </div>
    </section>

    <section>
        <div class="w3-cell-row w3-padding w3-gray">
            <div class="w3-container w3-cell w3-cell-middle">
                <table class="w3-table w3-stripped w3-bordered  w3-border w3-small">
                    <tr>
                        <th>Registrador</th>
                        <th>Valor</th>
                    </tr>
                    <tr>
                        <td>$zero</td>
                        <td>00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$at</td>
                        <td>Reservado</td>
                    </tr>

                    <tr>
                        <td>$v0</td>
                        <td id="v0">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$v1</td>
                        <td id="v1">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$a0</td>
                        <td id="a0">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$a1</td>
                        <td id="a1">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$a2</td>
                        <td id="a2">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$a3</td>
                        <td id="a3">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t0</td>
                        <td id="t0">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t1</td>
                        <td id="t1">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t2</td>
                        <td id="t2">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t3</td>
                        <td id="t3">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t4</td>
                        <td id="t4">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t5</td>
                        <td id="t5">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t6</td>
                        <td id="t6">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t7</td>
                        <td id="t7">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$r0</td>
                        <td id="r0">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$r1</td>
                        <td id="r1">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$r2</td>
                        <td id="r2">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$r3</td>
                        <td id="r3">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$r4</td>
                        <td id="r4">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$r5</td>
                        <td id="r5">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$r6</td>
                        <td id="r6">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$r7</td>
                        <td id="r7">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t8</td>
                        <td id="t8">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$t9</td>
                        <td id="t9">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$k0</td>
                        <td id="k0">Reservado pelo S.O</td>
                    </tr>

                    <tr>
                        <td>$k1</td>
                        <td id="k1">Reservado pelo S.O</td>
                    </tr>

                    <tr>
                        <td>$gp</td>
                        <td id="gp">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$sp</td>
                        <td id="sp">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$fp</td>
                        <td id="fp">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>$ra</td>
                        <td id="ra">00000000000000000000000000000000</td>
                    </tr>
                </table>
            </div>

            <div class="w3-container w3-cell w3-cell-top">

                <table class="w3-table w3-stripped w3-bordered">
                    <tr></tr>
                    <tr>
                        <td>ciclo</td>
                        <td id="cycle">0</td>
                    </tr>
                    <tr>
                        <td>$pc</td>
                        <td id="pc">00000000000000000000000000000000</td>
                    </tr>
                </table>

                <br>
                <table class="w3-table w3-stripped w3-bordered">
                    <tr>
                        <th>Estagio</th>
                        <th>Comando</th>
                    </tr>
                    <tr>
                        <td>Instruction Fetch</td>
                        <td id="lbl-if"></td>
                    </tr>
                    <tr>
                        <td>Instruction Decode</td>
                        <td id="lbl-id"></td>
                    </tr>
                    <tr>
                        <td>Execute</td>
                        <td id="lbl-exec"></td>
                    </tr>
                    <tr>
                        <td>Memory Read</td>
                        <td id="lbl-mem"></td>
                    </tr>
                    <tr>
                        <td>Write back</td>
                        <td id="lbl-wb"></td>
                    </tr>
                </table>

                <div class="w3-bar w3-center" style="margin-top: 1em;">
                    <button id="btn-run" class="w3-button w3-black w3-disabled">Rodar</button>
                    <button id="btn-next" class="w3-button w3-teal w3-disabled">Proximo passo</button>
                    <button id="btn-reset" class="w3-button w3-red">Reset</button>
                </div>
            </div>

            <div class="w3-container w3-cell w3-cell-top">
                <table class="w3-table w3-stripped w3-bordered w3-border w3-small">
                    <tr>
                        <th>Registrador</th>
                        <th>Valor</th>
                    </tr>
                    <tr>
                        <td>IF/ID</td>
                        <td id="if-id">00000000000000000000000000000000</td>
                    </tr>

                    <tr>
                        <td>ID/EX</td>
                        <td id="id-ex"></td>
                    </tr>

                    <tr>
                        <td>EX/MEM</td>
                        <td id="ex-mem"></td>
                    </tr>

                    <tr>
                        <td>MEM/WB</td>
                        <td id="mem-wb"></td>
                    </tr>
                </table>
            </div>
        </div>
    </section>

    <script>
        function wrap() {
            let wrapper = document.getElementById('hide');
            let btn = document.getElementById('close');
            console.log('po')

            if (wrapper.className.indexOf("none") == -1) {
                wrapper.className += " none";
                btn.innerHTML = "Mostrar <i>"
                btn.className += " hid";
            } else {
                wrapper.className = wrapper.className.replace(" none", "");
                btn.innerHTML = "Esconder <i>"
                btn.className = btn.className.replace(" hid", "");
            }
        }
    </script>
    <script>
        const fileInput = document.getElementById('file-input');
        const textArea = document.getElementById('text-input');

        // carrega arquivo para a area de texto
        fileInput.addEventListener('change', (e) => {
            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = function (event) {
                const content = event.target.result;
                textArea.innerHTML = content;
            }

            reader.readAsText(file);
        });

        // Nao permite digitar nada alem de 0 e 1 na caixa de texto
        textArea.addEventListener('keydown', (e) => {
            switch (e.key) {
                case '0':
                case '1':
                case 'Enter':
                case 'Backspace':
                case 'ArrowUp':
                case 'ArrowDown':
                case 'ArrowLeft':
                case 'ArrowRight':
                    break;

                default:
                    e.preventDefault();
            }
        }, false);
    </script>

    <script src="alu.js"></script>
    <script src="controls.js"></script>
    <script src="converter.js"></script>
    <script src="simulador.js"></script>
</body>

</html>